<!DOCTYPE html>
<html lang="en">
<head>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-U1DAWAznBHeqEIlVSCgzq+c9gqGAJn5c/t99JyeKa9xxaYpSvHU5awsuZVVFIhvj"
            crossorigin="anonymous"></script>

    <meta charset="UTF-8">
    <title>Kitchen</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Gothic+A1:wght@300&display=swap" rel="stylesheet">
    <script src="/static/js/jquery-2.0.0.min.js" type="text/javascript"></script>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css" rel="stylesheet"
          id="bootstrap-css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>

    <style>
        . {
            font-family: 'Gothic A1', sans-serif;
        }

        th, thead {
            text-align: center;
        }

        complete {
            text-aling: center;
        }

        #btn1 {
            margin-right: 8px;
        }

    </style>
    <script>
        $(document).ready(function () {
            kitchen_listing()
        })

        function kitchen_listing() {
            $.ajax({
                type: "GET",
                url: "/kitchen_pos",
                data: {},
                success: function (response) {

                    let orders = response['all_orders']
                    for (let i = 0; i < orders.length; i++) {

                        let menu_list = ""
                        let o_id = orders[i]['o_id']
                        let table_no = orders[i]['table_no']

                        let menu_length = orders[i]['menu'].length
                        console.log("length: ", menu_length)
                        // console.log("orders[i].menu: ",orders[i].menu)
                        // console.log("ordrers[i].menu[0].name",orders[i].menu[0].name)

                        for (let j = 0; j < menu_length; j++) {
                            let menu = orders[i].menu
                            let menu_name = menu[j].name
                            let menu_count = menu[j].count
                            menu_list = menu_list + menu_name + " : " + menu_count + ", "
                        }
                        // console.log('menu_one: ', menu_one)

                        let total_price = orders[i]['total_price']
                        let status = orders[i]['status']
                        let menu = menu_list[i]
                        // menu_list=menu_list.substr(0,menu_list.length-1);

                        console.log(o_id, table_no, menu_list, total_price, status)
                        console.log(menu_list.substr(0, menu_list, length - 1))

                        let temp_html = `    <tr>
    <td><input type="checkbox" class="checkthis" /></td>
    <td>${o_id}</td>
    <td>${table_no}</td>
    <td>${menu_list.substr(0, menu_list.length - 2)}</td>
    <td>${total_price}</td>
    <td class="menu_status">${status}</td>
    <td><p data-placement="top" data-toggle="tooltip" title="process"><button data-status="${status}" data-oid="${o_id}" id="process"  class="btn btn-success btn-xs" style="color:white" data-title="Delete"  ><span class="glyphicon glyphicon-ok"  ></span></button></p></td>
<!-- modal보류 : data-toggle="modal" data-target="#modify"-->
    </tr>`
                        $('#kitchen_list').append(temp_html)
                    }
                }
            })
        }


        //체크박스 눌렀을 때 상태 변경하는 코드
        // $('.complete').click(function () {
        //     alert("변경했음!")
        // });

        //modal에서 yes눌렀을때 닫는거
        $(document).on("click", ".complete", function () {
            $('#modify').modal("hide");
            console.log("모달 닫기")
            // alert("변경했음!")
        })

        //check색깔 바꾸는거
        //  $(document).on("click", "#process", function () {
        //      console.log("함수 실행1");
        //     $('#process').toggle(function(){
        //         console.log("함수 실행2");
        //         $("#process").removeClass("btn-danger");
        //         $("#process").addClass("btn-success")
        //     }, function(){
        //         console.log("함수 실행3");
        //         $("#process").removeClass("btn-success");
        //         $("#process").addClass("btn-danger");
        //     });
        // })

        // function toggleFunction(){
        //     console.log("함수 실행1");
        //     $('process').toggle(function(){
        //         console.log("함수 실행2");
        //         $("#process").removeClass("btn-danger");
        //         $("#process").addClass("btn-success")
        //     }, function(){
        //         console.log("함수 실행3");
        //         $("#process").remove("btn-success");
        //         $("#process").addClass("btn-danger");
        //     });
        // }

        $(document).on("click", "#process", function () {
            console.log("함수 실행됨!");

            let o_id = $(this).data('oid');
            let status = $(this).data('status');
            console.log(o_id, status);

            var data = JSON.stringify({o_id_give: o_id});

            $.ajax({
                type: "POST",
                url: "/process",
                contentType: "application/json",
                data: data,
                success: function (response) {
                }
            })

             location.reload();
        })






    </script>

</head>
<body>


<div class="container">
    <div class="row">


        <div class="col-md-12">
            <h4 class="title"><b>[주방 pos]</b></h4>
            <br>

            <div class="table-responsive">


                <table id="mytable" class="table table-bordred table-striped">

                    <thead>

                    <th><input type="checkbox" id="checkall"/></th>
                    <th>주문번호</th>
                    <th>테이블 번호</th>
                    <th>주문 메뉴</th>
                    <th>총 가격</th>
                    <th>상태</th>
                    <th>상태 변경</th>
                    </thead>
                    <tbody id="kitchen_list">

                    <!--                    <tr>-->
                    <!--                        <td><input type="checkbox" class="checkthis"/></td>-->
                    <!--                        <td>Mohsin</td>-->
                    <!--                        <td>Irshad</td>-->
                    <!--                        <td>CB 106/107 Street # 11 Wah Cantt Islamabad Pakistan</td>-->
                    <!--                        <td>isometric.mohsin@gmail.com</td>-->
                    <!--                        <td>+923335586757</td>-->
                    <!--                        <td>-->
                    <!--                            <p data-placement="top" data-toggle="tooltip" title="Edit">-->
                    <!--                                <button class="btn btn-primary btn-xs" data-title="Edit" data-toggle="modal"-->
                    <!--                                        data-target="#edit"><span class="glyphicon glyphicon-pencil"></span></button>-->
                    <!--                            </p>-->
                    <!--                        </td>-->
                    <!--                        <td>-->
                    <!--                            <p data-placement="top" data-toggle="tooltip" title="Delete">-->
                    <!--                                <button class="btn btn-danger btn-xs" data-title="Delete" data-toggle="modal"-->
                    <!--                                        data-target="#delete"><span class="glyphicon glyphicon-trash"></span></button>-->
                    <!--                            </p>-->
                    <!--                        </td>-->
                    <!--                    </tr>-->

                    </tbody>

                </table>
                <div>
                    <button id="btn1" class="btn btn-primary" href="#">로봇 호출</button>
                    <button id="btn2" class="btn btn-primary" href="#">서빙 준비 완료</button>
                </div>


                <div class="clearfix"></div>
                <ul class="pagination pull-right">
                    <li class="disabled"><a href="#"><span class="glyphicon glyphicon-chevron-left"></span></a></li>
                    <li class="active"><a href="#">1</a></li>
                    <li><a href="#">2</a></li>
                    <li><a href="#">3</a></li>
                    <li><a href="#">4</a></li>
                    <li><a href="#">5</a></li>
                    <li><a href="#"><span class="glyphicon glyphicon-chevron-right"></span></a></li>
                </ul>

            </div>

        </div>
    </div>
</div>


<div class="modal fade" id="modify" tabindex="-1" role="modify" aria-labelledby="edit" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true"><span
                        class="glyphicon glyphicon-remove" aria-hidden="true"></span></button>
                <h4 class="modal-title custom_align" id="Heading">처리 완료</h4>
            </div>
            <div class="modal-body">

                <div class="alert alert-danger"><span class="glyphicon glyphicon-warning-sign"></span> 상태를
                    변경하시겠습니까?
                </div>

            </div>
            <div class="modal-footer ">
                <button type="button" class="btn btn-success complete"><span class="glyphicon glyphicon-ok-sign"></span> Yes
                </button>
                <button type="button" class="btn btn-default" data-dismiss="modal"><span
                        class="glyphicon glyphicon-remove"></span> No
                </button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>

</body>
</html>